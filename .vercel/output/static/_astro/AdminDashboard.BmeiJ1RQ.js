import{j as e}from"./jsx-runtime.D_zvdyIk.js";import{r as o}from"./index.D55ewHcJ.js";import{s as p}from"./supabase.CKd-pqSN.js";/**
 * @license lucide-react v0.561.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const $=r=>r.replace(/([a-z0-9])([A-Z])/g,"$1-$2").toLowerCase(),A=r=>r.replace(/^([A-Z])|[\s-_]+(\w)/g,(t,n,a)=>a?a.toUpperCase():n.toLowerCase()),S=r=>{const t=A(r);return t.charAt(0).toUpperCase()+t.slice(1)},M=(...r)=>r.filter((t,n,a)=>!!t&&t.trim()!==""&&a.indexOf(t)===n).join(" ").trim(),I=r=>{for(const t in r)if(t.startsWith("aria-")||t==="role"||t==="title")return!0};/**
 * @license lucide-react v0.561.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */var z={xmlns:"http://www.w3.org/2000/svg",width:24,height:24,viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:2,strokeLinecap:"round",strokeLinejoin:"round"};/**
 * @license lucide-react v0.561.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const L=o.forwardRef(({color:r="currentColor",size:t=24,strokeWidth:n=2,absoluteStrokeWidth:a,className:d="",children:c,iconNode:k,...b},j)=>o.createElement("svg",{ref:j,...z,width:t,height:t,stroke:r,strokeWidth:a?Number(n)*24/Number(t):n,className:M("lucide",d),...!c&&!I(b)&&{"aria-hidden":"true"},...b},[...k.map(([u,v])=>o.createElement(u,v)),...Array.isArray(c)?c:[c]]));/**
 * @license lucide-react v0.561.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const N=(r,t)=>{const n=o.forwardRef(({className:a,...d},c)=>o.createElement(L,{ref:c,iconNode:t,className:M(`lucide-${$(S(r))}`,`lucide-${r}`,a),...d}));return n.displayName=S(r),n};/**
 * @license lucide-react v0.561.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const q=[["rect",{width:"18",height:"18",x:"3",y:"3",rx:"2",ry:"2",key:"1m3agn"}],["circle",{cx:"9",cy:"9",r:"2",key:"af1f0g"}],["path",{d:"m21 15-3.086-3.086a2 2 0 0 0-2.828 0L6 21",key:"1xmnt7"}]],U=N("image",q);/**
 * @license lucide-react v0.561.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const R=[["path",{d:"M5 12h14",key:"1ays0h"}],["path",{d:"M12 5v14",key:"s699le"}]],D=N("plus",R);/**
 * @license lucide-react v0.561.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const F=[["path",{d:"M15.2 3a2 2 0 0 1 1.4.6l3.8 3.8a2 2 0 0 1 .6 1.4V19a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2z",key:"1c8476"}],["path",{d:"M17 21v-7a1 1 0 0 0-1-1H8a1 1 0 0 0-1 1v7",key:"1ydtos"}],["path",{d:"M7 3v4a1 1 0 0 0 1 1h7",key:"t51u73"}]],O=N("save",F);/**
 * @license lucide-react v0.561.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const H=[["path",{d:"M12 3H5a2 2 0 0 0-2 2v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2v-7",key:"1m0v6g"}],["path",{d:"M18.375 2.625a1 1 0 0 1 3 3l-9.013 9.014a2 2 0 0 1-.853.505l-2.873.84a.5.5 0 0 1-.62-.62l.84-2.873a2 2 0 0 1 .506-.852z",key:"ohrbg2"}]],V=N("square-pen",H);/**
 * @license lucide-react v0.561.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const G=[["path",{d:"M10 11v6",key:"nco0om"}],["path",{d:"M14 11v6",key:"outv1u"}],["path",{d:"M19 6v14a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V6",key:"miytrc"}],["path",{d:"M3 6h18",key:"d0wm0j"}],["path",{d:"M8 6V4a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v2",key:"e791ji"}]],B=N("trash-2",G);/**
 * @license lucide-react v0.561.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const W=[["path",{d:"M12 3v12",key:"1x0j5s"}],["path",{d:"m17 8-5-5-5 5",key:"7q97r8"}],["path",{d:"M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4",key:"ih7n3h"}]],Z=N("upload",W);/**
 * @license lucide-react v0.561.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const J=[["path",{d:"M18 6 6 18",key:"1bl5f8"}],["path",{d:"m6 6 12 12",key:"d8bk6v"}]],K=N("x",J);function X({productToEdit:r,onSave:t,onCancel:n}){const[a,d]=o.useState({name:"",description:"",price:"",stock:"",category_id:"",image:null}),[c,k]=o.useState([]),[b,j]=o.useState(null),[u,v]=o.useState(!0);o.useEffect(()=>{async function l(){try{const{data:i,error:x}=await p.from("categorias").select("id, nombre").order("nombre");if(x)throw x;k(i||[]),!r&&i&&i.length>0&&d(h=>({...h,category_id:i[0].id}))}catch(i){console.error("Error cargando categorÃ­as:",i)}finally{v(!1)}}l()},[]),o.useEffect(()=>{r?(d({name:r.name||r.nombre||"",description:r.description||"",price:r.price||r.precio||"",stock:r.stock||"",category_id:r.categoria_id||r.categoria?.id||"",image:r.image||null}),j(r.image||r.imagenes?.[0]?.url||null)):(d(l=>({name:"",description:"",price:"",stock:"",category_id:c.length>0?c[0].id:"",image:null})),j(null))},[r,c]);const y=l=>{const{name:i,value:x}=l.target;d(h=>({...h,[i]:x}))},C=l=>{const i=l.target.files[0];if(i){d(h=>({...h,image:i}));const x=new FileReader;x.onloadend=()=>j(x.result),x.readAsDataURL(i)}},P=l=>{l.preventDefault(),t(a)};return e.jsxs("div",{className:"flex flex-col h-full bg-white",children:[e.jsxs("div",{className:"flex justify-between items-center px-6 py-4 border-b border-gray-100 flex-shrink-0",children:[e.jsx("h2",{className:"text-xl font-bold text-gray-800",children:r?"Editar Producto":"Crear Producto"}),e.jsx("button",{onClick:n,className:"text-gray-400 hover:text-gray-600 p-1 rounded-full hover:bg-gray-100 transition",children:e.jsx(K,{className:"h-5 w-5"})})]}),e.jsx("div",{className:"flex-1 overflow-y-auto px-6 py-4 custom-scrollbar",children:e.jsxs("form",{id:"product-form",onSubmit:P,className:"space-y-4",children:[e.jsxs("div",{className:"space-y-1.5",children:[e.jsx("label",{className:"text-sm font-semibold text-gray-700",children:"Nombre del Producto *"}),e.jsx("input",{name:"name",value:a.name,onChange:y,required:!0,placeholder:"Ej. Ibuprofeno 400mg",className:"w-full rounded-lg border border-gray-300 px-3 py-2 text-sm focus:ring-2 focus:ring-blue-500/20 focus:border-blue-500 outline-none transition"})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{className:"space-y-1.5",children:[e.jsx("label",{className:"text-sm font-semibold text-gray-700",children:"Precio *"}),e.jsxs("div",{className:"relative",children:[e.jsx("span",{className:"absolute left-3 top-2 text-gray-500",children:"$"}),e.jsx("input",{name:"price",type:"number",step:"0.01",value:a.price,onChange:y,required:!0,className:"w-full rounded-lg border border-gray-300 pl-7 pr-3 py-2 text-sm focus:ring-2 focus:ring-blue-500/20 focus:border-blue-500 outline-none transition"})]})]}),e.jsxs("div",{className:"space-y-1.5",children:[e.jsx("label",{className:"text-sm font-semibold text-gray-700",children:"Stock *"}),e.jsx("input",{name:"stock",type:"number",value:a.stock,onChange:y,required:!0,className:"w-full rounded-lg border border-gray-300 px-3 py-2 text-sm focus:ring-2 focus:ring-blue-500/20 focus:border-blue-500 outline-none transition"})]})]}),e.jsxs("div",{className:"space-y-1.5",children:[e.jsx("label",{className:"text-sm font-semibold text-gray-700",children:"CategorÃ­a"}),e.jsx("select",{name:"category_id",value:a.category_id,onChange:y,className:"w-full rounded-lg border border-gray-300 px-3 py-2 text-sm bg-white focus:ring-2 focus:ring-blue-500/20 focus:border-blue-500 outline-none transition",disabled:u,children:u?e.jsx("option",{children:"Cargando..."}):c.map(l=>e.jsx("option",{value:l.id,children:l.nombre},l.id))})]}),e.jsxs("div",{className:"space-y-1.5",children:[e.jsx("label",{className:"text-sm font-semibold text-gray-700",children:"DescripciÃ³n"}),e.jsx("textarea",{name:"description",value:a.description,onChange:y,rows:3,placeholder:"Detalles opcionales...",className:"w-full rounded-lg border border-gray-300 px-3 py-2 text-sm focus:ring-2 focus:ring-blue-500/20 focus:border-blue-500 outline-none transition resize-none"})]}),e.jsxs("div",{className:"space-y-2 pt-1",children:[e.jsx("label",{className:"text-sm font-semibold text-gray-700",children:"Imagen"}),e.jsxs("div",{className:"flex items-center gap-4 p-3 border border-dashed border-gray-300 rounded-lg bg-gray-50/50",children:[e.jsx("div",{className:"h-14 w-14 bg-white border border-gray-200 rounded-md flex items-center justify-center overflow-hidden shadow-sm flex-shrink-0",children:b?e.jsx("img",{src:b,alt:"Preview",className:"h-full w-full object-cover"}):e.jsx(U,{className:"h-6 w-6 text-gray-300"})}),e.jsxs("div",{className:"flex-1",children:[e.jsxs("label",{className:"cursor-pointer inline-flex items-center px-3 py-1.5 bg-white border border-gray-300 rounded text-xs font-medium text-gray-700 hover:bg-gray-50 hover:text-gray-900 transition-colors shadow-sm",children:[e.jsx(Z,{size:14,className:"mr-1.5"})," Elegir archivo",e.jsx("input",{type:"file",className:"hidden",accept:"image/*",onChange:C})]}),e.jsx("p",{className:"text-[10px] text-gray-400 mt-1",children:"Formatos: JPG, PNG, WEBP"})]})]})]})]})}),e.jsxs("div",{className:"px-6 py-4 bg-gray-50 border-t border-gray-100 flex justify-end gap-3 flex-shrink-0 rounded-b-xl",children:[e.jsx("button",{type:"button",onClick:n,className:"px-4 py-2 bg-white border border-gray-300 text-gray-700 rounded-lg text-sm font-medium hover:bg-gray-50 hover:border-gray-400 transition-all shadow-sm",children:"Cancelar"}),e.jsxs("button",{type:"submit",form:"product-form",className:"px-4 py-2 bg-slate-900 text-white rounded-lg text-sm font-medium hover:bg-slate-800 shadow-md hover:shadow-lg transition-all flex items-center gap-2",children:[e.jsx(O,{size:16}),r?"Guardar Cambios":"Crear Producto"]})]})]})}function ee(){const[r,t]=o.useState([]),[n,a]=o.useState(!0),[d,c]=o.useState(null),[k,b]=o.useState(null),[j,u]=o.useState(!1),[v,y]=o.useState(null);o.useEffect(()=>{C()},[]);const C=async()=>{try{a(!0),b(null);const{data:{user:s}}=await p.auth.getUser();if(!s)throw new Error("No hay usuario autenticado");const{data:m}=await p.from("usuarios_sistema").select("rol").eq("id",s.id).single();c(m?.rol);const{data:w,error:f}=await p.from("productos").select(`
          *,
          categoria:categorias(id, nombre),
          imagenes:imagenes_producto(url)
        `).order("creado_en",{ascending:!1});if(f)throw f;t(w||[])}catch(s){console.error("Error cargando datos:",s.message),b(s.message)}finally{a(!1)}},P=async s=>{try{a(!0);let m=null;if(s.image instanceof File){const g=`${Date.now()}-${s.image.name.replace(/\s/g,"-")}`,{error:_}=await p.storage.from("productos").upload(g,s.image);if(_)throw _;const{data:E}=p.storage.from("productos").getPublicUrl(g);m=E.publicUrl}const w={nombre:s.name,descripcion:s.description,precio:parseFloat(s.price),stock:parseInt(s.stock),categoria_id:s.category_id};let f=v?.id;if(v){const{error:g}=await p.from("productos").update(w).eq("id",f);if(g)throw g}else{const{data:g,error:_}=await p.from("productos").insert([w]).select().single();if(_)throw _;f=g.id}if(m&&f){const{error:g}=await p.from("imagenes_producto").insert([{producto_id:f,url:m}]);g&&console.warn("Error guardando referencia de imagen:",g)}u(!1),await C(),alert("Producto guardado correctamente")}catch(m){console.error("Error al guardar:",m),alert("Error al guardar: "+m.message)}finally{a(!1)}},l=async s=>{if(confirm("Â¿EstÃ¡s seguro de eliminar este producto?"))try{const m=[...r];t(r.filter(f=>f.id!==s));const{error:w}=await p.from("productos").delete().eq("id",s);if(w)throw w}catch(m){alert("Error eliminando: "+m.message),C()}},i=()=>{y(null),u(!0)},x=s=>{y(s),u(!0)},h=["admin","superadmin"].includes(d);return n&&r.length===0?e.jsx("div",{className:"p-10 text-center text-gray-500",children:"Cargando sistema..."}):e.jsxs("div",{className:"min-h-screen bg-gray-50 pb-12",children:[e.jsxs("div",{className:"flex justify-between items-center mb-6",children:[e.jsxs("div",{children:[e.jsx("h2",{className:"text-2xl font-bold text-gray-800",children:"Inventario"}),e.jsxs("p",{className:"text-sm text-gray-500",children:["GestiÃ³n de ",r.length," productos"]})]}),h&&e.jsxs("button",{onClick:i,className:"bg-slate-900 text-white px-4 py-2 rounded-md hover:bg-slate-800 flex items-center gap-2 shadow-sm transition-all",children:[e.jsx(D,{size:18})," Nuevo Producto"]})]}),k&&e.jsxs("div",{className:"mb-4 p-4 bg-red-50 border border-red-200 text-red-700 rounded-md",children:["âš ï¸ ",k]}),e.jsx("div",{className:"bg-white rounded-lg shadow-sm border border-gray-200 overflow-hidden",children:e.jsxs("div",{className:"overflow-x-auto",children:[e.jsxs("table",{className:"min-w-full divide-y divide-gray-200",children:[e.jsx("thead",{className:"bg-gray-50",children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-6 py-3 text-left text-xs font-semibold text-gray-500 uppercase",children:"Producto"}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-semibold text-gray-500 uppercase",children:"Precio"}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-semibold text-gray-500 uppercase",children:"Stock"}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-semibold text-gray-500 uppercase",children:"CategorÃ­a"}),h&&e.jsx("th",{className:"px-6 py-3 text-right text-xs font-semibold text-gray-500 uppercase",children:"Acciones"})]})}),e.jsx("tbody",{className:"bg-white divide-y divide-gray-200",children:r.map(s=>e.jsxs("tr",{className:"hover:bg-slate-50 transition-colors",children:[e.jsx("td",{className:"px-6 py-4 whitespace-nowrap",children:e.jsxs("div",{className:"flex items-center",children:[e.jsx("div",{className:"h-10 w-10 flex-shrink-0 bg-gray-100 rounded overflow-hidden border border-gray-200",children:e.jsx("img",{className:"h-10 w-10 object-cover",src:s.imagenes?.[0]?.url||"https://placehold.co/50",alt:s.nombre})}),e.jsx("div",{className:"ml-4",children:e.jsx("div",{className:"text-sm font-medium text-gray-900",children:s.nombre})})]})}),e.jsxs("td",{className:"px-6 py-4 whitespace-nowrap text-sm font-semibold text-slate-700",children:["$",s.precio?.toLocaleString("es-AR")]}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap",children:e.jsx("span",{className:`px-2 py-1 inline-flex text-xs leading-5 font-semibold rounded-full 
                      ${s.stock===0?"bg-red-100 text-red-800":s.stock<5?"bg-yellow-100 text-yellow-800":"bg-green-100 text-green-800"}`,children:s.stock===0?"Agotado":`${s.stock} u.`})}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-gray-500",children:s.categoria?.nombre||"-"}),h&&e.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-right text-sm font-medium",children:e.jsxs("div",{className:"flex justify-end gap-2",children:[e.jsx("button",{onClick:()=>x(s),className:"text-slate-400 hover:text-blue-600 p-1 rounded hover:bg-blue-50 transition-colors",title:"Editar",children:e.jsx(V,{size:18})}),e.jsx("button",{onClick:()=>l(s.id),className:"text-slate-400 hover:text-red-600 p-1 rounded hover:bg-red-50 transition-colors",title:"Eliminar",children:e.jsx(B,{size:18})})]})})]},s.id))})]}),r.length===0&&!n&&e.jsx("div",{className:"p-12 text-center text-gray-400 text-sm",children:"No hay productos en el inventario."})]})}),j&&e.jsxs("div",{className:"fixed inset-0 z-50 flex items-center justify-center p-4 bg-black/60 backdrop-blur-sm transition-opacity",children:[e.jsx("div",{className:"absolute inset-0",onClick:()=>u(!1)}),e.jsx("div",{className:"relative w-full max-w-2xl bg-white rounded-xl shadow-2xl overflow-hidden animate-in zoom-in-95 duration-200 z-10 h-[85vh] flex flex-col",children:e.jsx(X,{productToEdit:v,onSave:P,onCancel:()=>u(!1)})})]}),!h&&!n&&e.jsx("div",{className:"mt-4 bg-blue-50 border-l-4 border-blue-500 p-4 rounded-r",children:e.jsxs("p",{className:"text-sm text-blue-800",children:["ðŸ‘‹ Vista de ",e.jsx("strong",{children:"Operador"}),". Solo lectura."]})})]})}export{ee as default};
