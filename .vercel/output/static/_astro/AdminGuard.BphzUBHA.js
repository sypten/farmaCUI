import{j as r}from"./jsx-runtime.D_zvdyIk.js";import{r as s}from"./index.D55ewHcJ.js";import{s as t}from"./supabase.CKd-pqSN.js";function p({children:d,allowedRoles:n=["admin","superadmin","staff"]}){const[c,l]=s.useState(!1),[u,e]=s.useState(!0);return s.useEffect(()=>{async function f(){try{console.log("üîç AdminGuard: Verificando sesi√≥n...");const{data:{session:o}}=await t.auth.getSession();if(!o){console.warn("‚ùå AdminGuard: No hay sesi√≥n activa"),e(!1),window.location.href="/login";return}console.log("‚úÖ AdminGuard: Sesi√≥n encontrada. Verificando rol...");const{data:a,error:i}=await t.from("usuarios_sistema").select("rol").eq("id",o.user.id).single();if(i){console.error("‚ùå AdminGuard: Error en BD:",i.message),e(!1),window.location.href="/";return}if(!a||!n.includes(a.rol)){console.warn(`‚õî AdminGuard: Acceso denegado. Rol: ${a?.rol}`),e(!1),window.location.href="/";return}console.log(`‚úÖ AdminGuard: Autorizado. Rol: ${a.rol}`),l(!0),e(!1)}catch(o){console.error("‚ùå AdminGuard: Error inesperado:",o),e(!1),window.location.href="/"}}f()},[n]),u?r.jsxs("div",{className:"min-h-screen flex flex-col items-center justify-center bg-gray-50",children:[r.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-b-4 border-farma-primary"}),r.jsx("p",{className:"mt-4 text-farma-secondary font-bold animate-pulse",children:"Verificando acceso..."})]}):c?r.jsx(r.Fragment,{children:d}):null}export{p as default};
