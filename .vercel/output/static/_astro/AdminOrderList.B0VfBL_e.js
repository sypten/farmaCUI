import{j as e}from"./jsx-runtime.D_zvdyIk.js";import{r as i}from"./index.D55ewHcJ.js";import{s as l}from"./supabase.CKd-pqSN.js";function g(){const[r,c]=i.useState([]),[m,d]=i.useState(!0);i.useEffect(()=>{o()},[]);const o=async()=>{d(!0);const{data:a,error:t}=await l.from("ventas").select(`
        *,
        detalle_ventas (
          cantidad,
          precio_final_unitario,
          producto:productos (nombre)
        )
      `).order("fecha",{ascending:!1});t?console.error("Error cargando ventas:",t):c(a),d(!1)},x=async(a,t)=>{const{error:s}=await l.from("ventas").update({estado:t}).eq("id",a);s?alert("Error actualizando: "+s.message):c(r.map(n=>n.id===a?{...n,estado:t}:n))},f={pendiente:"bg-farma-warning bg-opacity-20 text-farma-warning border-farma-warning/30",pagado:"bg-farma-primary bg-opacity-20 text-farma-primary border-farma-primary/30",enviado:"bg-farma-accent bg-opacity-20 text-farma-accent border-farma-accent/30",entregado:"bg-farma-success bg-opacity-20 text-farma-success border-farma-success/30",cancelado:"bg-farma-error bg-opacity-20 text-farma-error border-farma-error/30"};return m?e.jsx("div",{className:"flex justify-center items-center py-10",children:e.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-farma-primary"})}):e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsxs("h2",{className:"text-xl font-bold text-farma-text",children:["ğŸ“¦ Ãšltimos Pedidos (",r.length,")"]}),e.jsx("button",{onClick:o,className:"text-sm text-farma-primary hover:text-farma-secondary transition",children:"ğŸ”„ Actualizar"})]}),e.jsxs("div",{className:"bg-white rounded-lg shadow overflow-hidden border border-farma-muted",children:[e.jsxs("table",{className:"min-w-full divide-y divide-farma-muted",children:[e.jsx("thead",{className:"bg-farma-accent bg-opacity-10",children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-farma-text uppercase tracking-wider",children:"Orden / Cliente"}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-farma-text uppercase tracking-wider",children:"Productos"}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-farma-text uppercase tracking-wider",children:"Total"}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-farma-text uppercase tracking-wider",children:"Estado"})]})}),e.jsx("tbody",{className:"bg-white divide-y divide-gray-200",children:r.map(a=>e.jsxs("tr",{className:"hover:bg-farma-accent hover:bg-opacity-5 transition",children:[e.jsxs("td",{className:"px-6 py-4",children:[e.jsxs("div",{className:"text-sm font-bold text-farma-text",children:["#",a.numero_orden]}),e.jsx("div",{className:"text-sm text-farma-gray",children:a.cliente_nombre}),e.jsx("div",{className:"text-xs text-farma-gray/60 mt-1",children:new Date(a.fecha).toLocaleDateString()}),!a.cliente_id&&e.jsx("span",{className:"inline-flex mt-1 items-center px-2 py-0.5 rounded text-xs font-medium bg-farma-accent bg-opacity-10 text-farma-text",children:"Invitado"})]}),e.jsx("td",{className:"px-6 py-4",children:e.jsx("ul",{className:"text-sm text-farma-text space-y-1",children:a.detalle_ventas.map((t,s)=>e.jsxs("li",{children:[e.jsxs("span",{className:"font-bold",children:[t.cantidad,"x"]})," ",t.producto?.nombre||"Producto borrado"]},s))})}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap",children:e.jsxs("div",{className:"text-sm font-bold text-farma-primary",children:["$ ",a.total_final.toLocaleString("es-AR")]})}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap",children:e.jsxs("select",{value:a.estado,onChange:t=>x(a.id,t.target.value),className:`block w-full text-xs font-bold py-1 px-2 rounded border focus:outline-none focus:ring-2 focus:ring-farma-primary cursor-pointer ${f[a.estado]||"bg-farma-accent bg-opacity-10"}`,children:[e.jsx("option",{value:"pendiente",children:"ğŸ•’ Pendiente"}),e.jsx("option",{value:"pagado",children:"ğŸ’° Pagado"}),e.jsx("option",{value:"enviado",children:"ğŸšš Enviado"}),e.jsx("option",{value:"entregado",children:"âœ… Entregado"}),e.jsx("option",{value:"cancelado",children:"âŒ Cancelado"})]})})]},a.id))})]}),r.length===0&&e.jsx("div",{className:"p-10 text-center text-farma-gray",children:"No hay pedidos registrados todavÃ­a."})]})]})}export{g as default};
